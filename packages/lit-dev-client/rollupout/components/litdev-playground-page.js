import"../playground-connected-element.js";import"../litdev-icon-button.js";import"../playground-ide.js";import"../litdev-example-controls.js";import{s as t,r as e,e as i,$ as n,n as o,t as s,w as r,a}from"../lit.js";import"./copy-button.js";import{C as c,g as d}from"../code-language-preference.js";import"../tslib.js";import"../mwc-base.js";import"../inert.esm.js";import"../litdev-code-language-switch.js";import"../litdev-ripple-icon-button.js";var l=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?h(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&l(e,i,s),s};let u=class extends t{constructor(){super(...arguments),this.open=!1,this.placement="bottom-end",this._clickStartedWithinThis=!1,this._onThisMousedown=()=>{this._clickStartedWithinThis=!0},this._onWindowMouseup=()=>{this._clickStartedWithinThis?this._clickStartedWithinThis=!1:this.open=!1},this._onWindowKeydown=t=>{"Escape"===t.key&&(this.open=!1)}}update(t){t.has("open")&&(this.open?(this._addEventListeners(),this.dispatchEvent(new Event("open")),setTimeout((()=>{this.focus()}))):t.get("open")&&(this._removeEventListeners(),this.dispatchEvent(new Event("closed")))),this.open&&(t.has("anchor")||t.has("placement")||t.has("open"))&&this._calculatePosition(),super.update(t)}disconnectedCallback(){super.disconnectedCallback(),this._removeEventListeners()}render(){return n`<slot></slot><div part="arrow"></div>`}_calculatePosition(){let t,e,i;if(void 0===this.anchor)t=0,e=0,i=0;else if("bottom-end"===this.placement){const n=this.anchor.getBoundingClientRect();t=n.bottom,e=window.innerWidth-n.right,i=n.width/2}this.style.setProperty("--litdev-flyout-top",t+"px"),this.style.setProperty("--litdev-flyout-right",e+"px"),this.style.setProperty("--litdev-flyout-arrow-right",i+"px")}_addEventListeners(){window.addEventListener("keydown",this._onWindowKeydown),this.addEventListener("mousedown",this._onThisMousedown),requestAnimationFrame((()=>{this.open&&window.addEventListener("mouseup",this._onWindowMouseup)}))}_removeEventListeners(){window.removeEventListener("keydown",this._onWindowKeydown),this.removeEventListener("mousedown",this._onThisMousedown),window.removeEventListener("mouseup",this._onWindowMouseup)}};u.shadowRootOptions={...t.shadowRootOptions,delegatesFocus:!0},u.styles=e`:host{background:#fff;border-radius:5px;border:1px solid #ccc;box-shadow:rgb(0 0 0 / 20%) 0 0 3px 1px;box-sizing:border-box;color:#000;margin-top:10px;max-width:calc(100vw - var(--litdev-flyout-right,0));position:fixed;right:var(--litdev-flyout-right,0);top:var(--litdev-flyout-top,0)}:host(:not([open])){display:none}[part=arrow]{background:inherit;border:inherit;border-bottom:none;border-right:none;height:10px;position:absolute;right:var(--litdev-flyout-arrow-right,0);top:calc(-6px);transform:rotate(45deg);width:10px}`,p([i({type:Boolean,reflect:!0})],u.prototype,"open",2),p([i({attribute:!1})],u.prototype,"anchor",2),p([i()],u.prototype,"placement",2),u=p([o("litdev-flyout")],u);
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class g extends Error{constructor(t){super(t.message),this.heading=t.heading,t.stack&&(this.stack=t.stack)}}const w=t=>{let e;e=t instanceof g?t:new g({heading:"Unexpected error",message:t.message??"",stack:t.stack}),window.dispatchEvent(new CustomEvent("error",{detail:e}))},v=()=>(t,e,i)=>{const n=i.value;i.value=function(...t){try{const e=n.apply(this,t);return e instanceof Promise?e.catch((t=>{throw w(t),t})):e}catch(t){throw w(t),t}}},m=(t,e)=>new Promise((i=>{const n=setInterval((()=>{t.closed&&(i("closed"),clearInterval(n))}),e)})),y="application/vnd.github.v3+json";class b extends Error{constructor(t,e,i,n,o){super(`Error calling GitHub API ${e} ${t.pathname}`+(i?` (HTTP status ${i})`:"")+(n?": "+n:"")),this.url=t,this.status=i,o&&(this.stack=o)}}const _=async(t,e)=>{try{const i=await fetch(t.href,e);if(!i.ok)throw new b(t,e?.method??"GET",i.status);return await i.json()}catch(i){throw i instanceof b||(i=new b(t,e?.method??"GET",void 0,i.message,i.stack)),i}},f=n`<svg viewBox="0 0 24 24" fill="currentcolor"><path d="M12,2C6.48,2,2,6.59,2,12.25c0,4.53,2.87,8.37,6.84,9.73c0.5,0.09,0.68-0.22,0.68-0.49c0-0.24-0.01-0.89-0.01-1.74c-2.78,0.62-3.37-1.37-3.37-1.37c-0.45-1.18-1.11-1.5-1.11-1.5c-0.91-0.64,0.07-0.62,0.07-0.62c1,0.07,1.53,1.06,1.53,1.06c0.89,1.57,2.34,1.11,2.91,0.85c0.09-0.66,0.35-1.11,0.63-1.37c-2.22-0.26-4.56-1.14-4.56-5.07c0-1.12,0.39-2.03,1.03-2.75c-0.1-0.26-0.45-1.3,0.1-2.71c0,0,0.84-0.28,2.75,1.05c0.8-0.23,1.65-0.34,2.5-0.34c0.85,0,1.7,0.12,2.5,0.34c1.91-1.33,2.75-1.05,2.75-1.05c0.55,1.41,0.2,2.45,0.1,2.71c0.64,0.72,1.03,1.63,1.03,2.75c0,3.94-2.34,4.81-4.57,5.06c0.36,0.32,0.68,0.94,0.68,1.9c0,1.37-0.01,2.48-0.01,2.81c0,0.27,0.18,0.59,0.69,0.49c3.97-1.36,6.83-5.2,6.83-9.73C22,6.59,17.52,2,12,2"></path></svg>`
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,E=t=>{const e={files:Object.fromEntries(t.map((({name:t,hidden:e},i)=>{const n={position:i};return e&&(n.hidden=!0),[t,n]})))},i=Object.fromEntries(t.filter((({content:t})=>""!==t)).map((({name:t,content:e})=>[t,{content:e}])));return i["zzzzzzzzzz-lit-dev-playground-metadata.json"]={content:JSON.stringify(e,null,2)},i};var k=Object.defineProperty,U=Object.getOwnPropertyDescriptor,x=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?U(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&k(e,i,s),s};const S=new WeakMap;let C=class extends t{constructor(){super(...arguments),this._pending=!1}render(){return this._signedInUser?n`${this._signedInStatus}<div id="gistActions">${this.canUpdateGist?this._updateGistButton:r} ${this._newGistButton}</div>`:this._signInButton}get _signInButton(){return n`<litdev-icon-button id="signInButton" .disabled="${this._pending}" @click="${this._signIn}">${f} Sign in to GitHub</litdev-icon-button>`}get _signedInStatus(){const{id:t,login:e}=this._signedInUser,i=new URL(`/u/${t}?s=48`,this.githubAvatarUrl).href;return n`<div id="signInStatus"><span><span>Signed in as <b>${e}</b></span> <img id="avatar" src="${i}" width="${24}" height="${24}"></span><a id="signOutButton" href="#" @click="${this._signOut}">Sign out</a></div>`}get _newGistButton(){return n`<litdev-icon-button id="createNewGistButton" .disabled="${this._pending}" @click="${this.createNewGist}">${f} Create new gist</litdev-icon-button>`}get _updateGistButton(){return n`<litdev-icon-button id="updateGistButton" .disabled="${this._pending}" @click="${this.updateGist}">${f} Update gist</litdev-icon-button>`}get _signedInUser(){const t=localStorage.getItem("github-user");if(t)return JSON.parse(t)}get isSignedIn(){return void 0!==this._signedInUser}get canUpdateGist(){if(!this.activeGist)return!1;const t=this._signedInUser;return!!t&&this.activeGist.owner.id===t.id}async _signIn(){this._pending=!0;try{if(!this.githubApiUrl||!this.clientId||!this.authorizeUrl)throw Error("Missing required properties");const t=await(async t=>{const e=new URL(t.authorizeUrl);e.searchParams.set("client_id",t.clientId),e.searchParams.set("scope","gist"),e.searchParams.set("redirect_uri",new URL("/playground/signin/",document.location.href).href);const i=window.screenY+window.outerHeight/2-325,n=window.screenX+window.outerWidth/2-300,o=window.open(e,"_blank",`width=600,height=650,top=${i},left=${n}`);if(null===o)throw new g({heading:"Could not open GitHub window",message:"We couldn't open the window that's required for signing in to GitHub. You may need to enable popups in your browser settings."});const s=()=>o.close();window.addEventListener("beforeunload",s);const r=(t=>{const e=new AbortController,i=()=>e.abort();return{promise:new Promise((n=>{window.addEventListener("message",(e=>{e.source===t&&e.origin===window.location.origin&&(n(e.data),i())}),{signal:e.signal})})),abort:i}})(o),a=await Promise.race([r.promise,m(o,250)]);if(window.removeEventListener("beforeunload",s),"closed"===a)throw r.abort(),new g({heading:"GitHub window closed",message:'It looks like you closed the GitHub window. If you still want to create a GitHub gist, you\'ll need to click "Authorize lit" when prompted by the popup window.'});o.close();const c=a;if(void 0!==c.error){if("access_denied"===c.error)throw new g({heading:"GitHub authorization declined",message:'It looks like you clicked the "Cancel" button. If you still want to create a GitHub gist, you\'ll need to click "Authorize lit" when prompted by the popup window.'});throw new g({heading:"Unknown GitHub authorization error",message:"Sorry! An unknown error occured while authorizing with GitHub. The following code is all we know: "+c.error})}return(async t=>{const e=new URL("/api/github-token-exchange",document.location.href);e.searchParams.set("code",t);const i=await fetch(e.href,{method:"POST"}),n=await i.json();if(void 0!==n.error||!i.ok)throw Error(`/api/github-token-exchange error [${i.status}]: ${n.error??"<unknown>"}`);return n.accessToken})(c.code)})({clientId:this.clientId,authorizeUrl:this.authorizeUrl});S.set(this,t);const{id:e,login:i}=await(async t=>{const e=new URL("/user",t.apiBaseUrl);return _(e,{headers:{accept:y,authorization:"token "+t.token}})})({apiBaseUrl:this.githubApiUrl,token:t});localStorage.setItem("github-user",JSON.stringify({id:e,login:i})),this.requestUpdate()}finally{this._pending=!1}}_signOut(t){t.preventDefault(),S.delete(this),localStorage.removeItem("github-user"),this.requestUpdate()}async createNewGist(){this._pending=!0;try{if(!this.githubApiUrl)throw Error("Missing required properties");const t=this.getProjectFiles?.();if(!t||0===t.length)throw Error("Can't save an empty project");this.dispatchEvent(new CustomEvent("status",{detail:{text:"Creating gist ..."},bubbles:!0}));let e=S.get(this);if(void 0===e&&await this._signIn(),e=S.get(this),void 0===e)throw Error("Error token not defined");const i=E(t),n=await(async(t,e)=>{const i=new URL("/gists",e.apiBaseUrl);return _(i,{method:"POST",headers:{accept:y,authorization:"token "+e.token},body:JSON.stringify({files:t})})})(i,{apiBaseUrl:this.githubApiUrl,token:e});this.dispatchEvent(new Event("will-hashchange",{bubbles:!0,composed:!0})),window.location.hash="#gist="+n.id;let o="Gist created";try{await navigator.clipboard.writeText(window.location.toString()),o+=" and URL copied to clipboard"}catch{o+=" and URL bar updated"}this.dispatchEvent(new Event("created")),this.dispatchEvent(new CustomEvent("status",{detail:{text:o},bubbles:!0}))}finally{this._pending=!1}}async updateGist(){this._pending=!0;try{if(!this.githubApiUrl||!this.activeGist)throw Error("Missing required properties");const t=this.getProjectFiles?.();if(!t||0===t.length)throw Error("Can't save an empty project");this.dispatchEvent(new CustomEvent("status",{detail:{text:"Updating gist ..."},bubbles:!0}));let e=S.get(this);if(void 0===e&&await this._signIn(),e=S.get(this),void 0===e)throw Error("Error token not defined");const i=E(t);for(const t of Object.keys(this.activeGist.files))i[t]||(i[t]={content:""});const n=await(async(t,e,i)=>{const n=new URL("/gists/"+t,i.apiBaseUrl);return _(n,{method:"PATCH",headers:{accept:y,authorization:"token "+i.token},body:JSON.stringify({gist_id:t,files:e})})})(this.activeGist.id,i,{apiBaseUrl:this.githubApiUrl,token:e});this.dispatchEvent(new Event("will-hashchange",{bubbles:!0,composed:!0})),window.location.hash="#gist="+n.id;let o="Gist updated";try{await navigator.clipboard.writeText(window.location.toString()),o+=" and URL copied to clipboard"}catch{}this.dispatchEvent(new Event("created")),this.dispatchEvent(new CustomEvent("status",{detail:{text:o},bubbles:!0}))}finally{this._pending=!1}}};C.styles=e`litdev-icon-button{background:var(--color-blue);color:#fff}litdev-icon-button:hover{background:#00f}#signInStatus{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;font-size:16px}#signInStatus>span{display:flex;align-items:center}#avatar{margin-left:8px;border-radius:50%}#signOutButton:visited{color:currentcolor}#signOutButton:hover{color:#00f}#gistActions{display:flex;justify-content:space-between}`,x([i()],C.prototype,"clientId",2),x([i()],C.prototype,"authorizeUrl",2),x([i()],C.prototype,"githubApiUrl",2),x([i()],C.prototype,"githubAvatarUrl",2),x([i({attribute:!1})],C.prototype,"getProjectFiles",2),x([s()],C.prototype,"_pending",2),x([i({attribute:!1})],C.prototype,"activeGist",2),x([v()],C.prototype,"_signIn",1),x([v()],C.prototype,"createNewGist",1),x([v()],C.prototype,"updateGist",1),C=x([o("litdev-playground-share-gist")],C);
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const j=t=>{const e={name:t.name,content:t.content};return t.hidden&&(e.hidden=!0),e};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var L=Object.defineProperty,$=Object.getOwnPropertyDescriptor,P=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?$(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&L(e,i,s),s};let O=class extends t{constructor(){super(...arguments),this._url=""}generateUrl(){const t=this.getProjectFiles?.();if(!t||0===t.length)return void console.error("Can't save empty project");const e=(t=>{const e=encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(parseInt(e,16)))),i=btoa(e).replace(/\+/g,"-").replace(/\//g,"_"),n=i.indexOf("=");return n>=0?i.slice(0,n):i})(JSON.stringify(t.map(j)));this._url=new URL("#project="+e,window.location.href).href}render(){return n`<input type="text" disabled="disabled" .value="${this._url}"><copy-button .text="${this._url}" @click="${this.save}"></copy-button>`}async save(){let t;history.pushState({},"",this._url);try{await navigator.clipboard.writeText(window.location.toString()),t="URL copied to clipboard"}catch{t+="URL bar updated"}this.dispatchEvent(new Event("copied")),this.dispatchEvent(new CustomEvent("status",{detail:{text:t},bubbles:!0}))}};O.shadowRootOptions={...t.shadowRootOptions,delegatesFocus:!0},O.styles=e`:host{align-items:center;display:flex}input{height:24px;min-width:50px;width:275px}copy-button{color:#3e3e3e;margin:0 -5px 0 10px;opacity:.75}copy-button:hover{opacity:1}`,P([s()],O.prototype,"_url",2),O=P([o("litdev-playground-share-long-url")],O);const G=n`<svg width="24" height="24" viewBox="0 0 7.9368957 14.252527" stroke="currentcolor" stroke-width="0.8" fill="none" aria-hidden="true"><rect width="3.4483507" height="3.4483507" x="5.8423676" y="0.2645835"/><rect width="3.4483507" height="3.4483507" x="-1.3794879" y="5.3813062"/><rect width="3.4483507" height="3.4483507" x="5.8680329" y="10.539593"/><path d="m 2.0688597,5.3813058 3.77351,-1.66837"/><path d="m 2.0688597,8.8296658 3.79917,1.7099312"/></svg>`;var I=Object.defineProperty,z=Object.getOwnPropertyDescriptor,B=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?z(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&I(e,i,s),s};let A=class extends t{constructor(){super(...arguments),this._open=!1,this._mostRecentSaveType=void 0,this._ignoreClick=!1,this._onWindowKeydown=t=>{"s"!==t.key.toLowerCase()||!t.ctrlKey&&!t.metaKey||t.repeat||(t.preventDefault(),"longurl"===this._mostRecentSaveType?(this._longUrl?.generateUrl(),this._dispatchSaveEvent(),this._longUrl?.save()):"gist"===this._mostRecentSaveType&&this._gist?.canUpdateGist?(this._dispatchSaveEvent(),this._gist?.updateGist()):this._open=!0)}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this._onWindowKeydown)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("keydown",this._onWindowKeydown)}update(t){t.has("_open")&&(this._open?(this._longUrl?.generateUrl(),this.dispatchEvent(new Event("opened"))):this.dispatchEvent(new Event("closed"))),super.update(t)}render(){return n`<litdev-icon-button @click="${this._onClick}">${G} Share</litdev-icon-button>${this._menu}<mwc-snackbar></mwc-snackbar>`}get _menu(){return n`<litdev-flyout id="menu" .anchor="${this}" .open="${this._open}" @closed="${this._onFlyoutClosed}" @status="${this._showStatus}"><section><h3>Long URL</h3><litdev-playground-share-long-url .getProjectFiles="${this.getProjectFiles}" @copied="${this._onLongUrlSaved}"></litdev-playground-share-long-url></section><section><h3>GitHub Gist</h3><litdev-playground-share-gist .clientId="${this.clientId}" .authorizeUrl="${this.authorizeUrl}" .githubApiUrl="${this.githubApiUrl}" .githubAvatarUrl="${this.githubAvatarUrl}" .getProjectFiles="${this.getProjectFiles}" .activeGist="${this.activeGist}" @created="${this._onGistSaved}"></litdev-playground-share-gist></section></litdev-flyout>`}_onFlyoutClosed(){this._open=!1,this._ignoreClick=!0,requestAnimationFrame((()=>{this._ignoreClick=!1}))}_onClick(){this._ignoreClick||(this._open=!0)}_close(){this._open=!1}async _showStatus(t){const e=this._snackbar;e&&(e.open&&(e.open=!1,await e.updateComplete),e.labelText=t.detail.text,e.open=!0)}_onLongUrlSaved(){this._dispatchSaveEvent(),this._close(),this._mostRecentSaveType="longurl",this.activeGist=void 0}_onGistSaved(){this._dispatchSaveEvent(),this._close(),this._mostRecentSaveType="gist"}_dispatchSaveEvent(){this.dispatchEvent(new Event("save",{bubbles:!1}))}};A.styles=e`section{padding:15px}section:not(:last-of-type){border-bottom:1px solid #ccc}section>h3{margin:0 0 10px 0;font-size:14px;font-weight:600}#menu{z-index:7}mwc-snackbar{background:#00f}`,B([i()],A.prototype,"clientId",2),B([i()],A.prototype,"authorizeUrl",2),B([i()],A.prototype,"githubApiUrl",2),B([i()],A.prototype,"githubAvatarUrl",2),B([s()],A.prototype,"_open",2),B([a("litdev-playground-share-long-url")],A.prototype,"_longUrl",2),B([a("litdev-playground-share-gist")],A.prototype,"_gist",2),B([a("mwc-snackbar")],A.prototype,"_snackbar",2),B([i({attribute:!1})],A.prototype,"getProjectFiles",2),B([i({attribute:!1})],A.prototype,"activeGist",2),A=B([o("litdev-playground-share-button")],A);const R=n`<svg width="24" height="24" viewBox="0 0 8.9403505 7.7663145" stroke="currentcolor" stroke-width="0.5" fill="none" aria-hidden="true"><g transform="translate(-60.514912,-89.035921)"><path d="m 60.779495,92.719876 v 3.817776 h 8.411184 v -3.768603"/><path d="M 64.978456,94.503808 V 89.035921"/><path d="M 66.807058,92.468875 64.978456,94.470831 63.117735,92.61011"/></g></svg>`,T={name:100,mode:8,uid:8,gid:8,size:12,mtime:12,chksum:8,typeflag:1,linkname:100,magic:5,version:2,uname:32,gname:32,devmajor:8,devminor:8,prefix:155,padding:12},F={};Object.keys(T).reduce(((t,e)=>(F[e]=t,t+T[e])),0);const H=["name","linkname","magic","chksum","typeflag","version","uname","gname"];function D(t,e){return("000000000000"+(t=t.toString(8))).slice(t.length+12-e)}function M(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}let W=class extends t{render(){return n`<litdev-icon-button @click="${this._onClick}">${R} Download</litdev-icon-button>`}async _onClick(){const t=this.getProjectFiles?.();if(!t)throw Error("Missing required properties");if(0===t.length)throw Error("Can't download an empty project");const e=t.map((({name:t,content:e})=>({name:t,content:e??""}))),i=e.reduce(((t,e)=>{"string"==typeof e.content&&(e.content=M(e.content)),e=Object.assign((t=>({name:t.name,mode:"777",uid:0,gid:0,size:t.content.byteLength,mtime:Math.floor(Number(new Date)/1e3),chksum:"        ",typeflag:"0",magic:"ustar",version:"  ",uname:"",gname:""}))(e),e);const i=new Uint8Array(512*Math.ceil((512+e.size)/512)),n=Object.keys(T).reduce(((t,n)=>{if(!(n in e))return t;const o=M(H.indexOf(n)>-1?e[n]:D(e[n],T[n]-1));return i.set(o,F[n]),t+o.reduce(((t,e)=>t+e),0)}),0);i.set(M(D(n,7)),F.chksum),i.set(e.content,512);const o=new Uint8Array(t.byteLength+i.byteLength);return o.set(t,0),o.set(i,t.byteLength),o}),new Uint8Array(0)),n=document.createElement("a");n.href=URL.createObjectURL(new Blob([i],{type:"application/tar"})),n.download="lit-playground.tar",n.click()}};W.styles=e`litdev-icon-button:hover{background:#00f}`,W=((t,e,i,n)=>{for(var o,s=e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=o(s)||s);return s})([o("litdev-playground-download-button")],W);var q=Object.defineProperty,N=Object.getOwnPropertyDescriptor,J=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?N(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&q(e,i,s),s};let K=class extends t{constructor(){super(...arguments),this._everHadErrors=!1,this._onError=t=>{this._error=t.detail,this._everHadErrors=!0}}connectedCallback(){super.connectedCallback(),window.addEventListener("error",this._onError)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("error",this._onError)}render(){return this._everHadErrors?n`<mwc-dialog .open="${void 0!==this._error}" .heading="${this._error?.heading??""}" @closed="${this._onClosed}"><p>${this._error?.message??""}</p><p>If you keep encountering this error, please file an issue at <a href="${this._reportUrl}" target="_blank" rel="noopener">github.com/lit/lit.dev/issues</a></p><mwc-button dialogAction="ok" slot="primaryAction">OK</mwc-button></mwc-dialog>`:r}get _reportUrl(){if(!this._error)return"";const t=new URL("https://github.com/lit/lit.dev/issues/new");return t.searchParams.set("title","Error: "+(this._error.heading??"unknown")),t.searchParams.set("body",`\nI encountered the following error on lit.dev:\n\n> ${this._error.heading}\n> ${this._error.message}\n\nStack trace:\n\`\`\`\n${this._error.stack}\n\`\`\`\n\nURL: ${document.location.href}\nSite version: \`${this.siteVersion}\`\nBrowser: \`${navigator.userAgent}\`\n\n<!-- Please add any additional information here. -->\n`),t.href}_onClosed(){this._error=void 0}};J([i()],K.prototype,"siteVersion",2),J([s()],K.prototype,"_error",2),K=J([o("litdev-error-notifier")],K);var V=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,X=(t,e,i,n)=>{for(var o,s=n>1?void 0:n?Y(e,i):e,r=t.length-1;r>=0;r--)(o=t[r])&&(s=(n?o(e,i,s):o(s))||s);return n&&s&&V(e,i,s),s};let Z=class extends t{constructor(){super(...arguments),this._hasUnsavedChanges=!1,this._onEditorChange=()=>{this._hasUnsavedChanges=!0},this._onSaveEvent=()=>{this._hasUnsavedChanges=!1},this._beforeUnload=t=>{if(this._hasUnsavedChanges)return(t||window.event).returnValue="non-void value",t.preventDefault(),"non-void value"}}async connectedCallback(){super.connectedCallback(),this._checkRequiredParameters(),await this._discoverChildElements(),this._activateChildElements(),this._syncStateFromUrlHash(),window.addEventListener("hashchange",(t=>this._syncStateFromUrlHash(t))),window.addEventListener(c,(()=>this._syncStateFromUrlHash())),this._codeEditor.addEventListener("change",this._onEditorChange),this._shareButton.addEventListener("save",this._onSaveEvent),this._shareButton.addEventListener("will-hashchange",this._onSaveEvent),window.addEventListener("beforeunload",this._beforeUnload)}render(){return n`<slot></slot>`}_checkRequiredParameters(){if(!this.githubApiUrl)throw Error("GitHub configuration parameter missing")}async _discoverChildElements(){const t=t=>{const e=this.querySelector(t);if(null===e)throw Error("Missing element "+t);return e};this._playgroundProject=t("playground-project"),this._playgroundPreview=t("playground-preview"),this._fileEditor=t("playground-file-editor"),this._shareButton=t("litdev-playground-share-button"),this._downloadButton=t("litdev-playground-download-button"),this._examplesDrawer=t("litdev-drawer"),this._exampleControls=t("litdev-example-controls"),this._examplesDrawerScroller=t("litdev-drawer .minimalScroller"),await this._fileEditor.updateComplete,this._codeEditor=this._fileEditor.shadowRoot.querySelector("playground-code-editor")}_activateChildElements(){this._shareButton.getProjectFiles=()=>this._playgroundProject.files,this._shareButton.addEventListener("opened",(()=>{this._playgroundPreview.style.pointerEvents="none"})),this._shareButton.addEventListener("closed",(()=>{this._playgroundPreview.style.pointerEvents="unset"})),this._downloadButton.getProjectFiles=()=>this._playgroundProject.files}_loadBase64(t){if(t)try{const e=(t=>{const e=t.replace(/-/g,"+").replace(/_/g,"/"),i=atob(e).split("").map((t=>"%"+t.charCodeAt(0).toString(16).padStart(2,"0"))).join("");return decodeURIComponent(i)})(t);try{return JSON.parse(e)}catch{console.error("Invalid JSON in URL",JSON.stringify(e))}}catch{console.error("Invalid project base64 in URL")}}async _loadGist(t){const e=await(async(t,e)=>{const i=new URL("/gists/"+t,e.apiBaseUrl);return _(i,{headers:{accept:y}})})(t,{apiBaseUrl:this.githubApiUrl});return this._shareButton.activeGist=e,(t=>{const e=t["zzzzzzzzzz-lit-dev-playground-metadata.json"];let i={files:{}};if(e)try{i=JSON.parse(e.content)||{}}catch(t){console.warn("Failed to JSON parse playground metadata file in gist")}const n={};for(const i of Object.values(t)){if(i===e||!i.filename)continue;const t={name:i.filename,content:i.content};n[t.name]=t}for(const[t,{hidden:e}]of Object.entries(i.files||{})){let i=n[t];i||(i={name:t,content:""},n[t]=i),e&&(i.hidden=!0)}return Object.values(n).sort(((t,e)=>{const n=i.files?.[t.name]?.position,o=i.files?.[e.name]?.position;return"number"==typeof n&&"number"==typeof o?n-o:0}))})(e.files).map(j)}async _syncStateFromUrlHash(t){let e=!0;if(t&&this._hasUnsavedChanges&&(e=window.confirm("You have unsaved changes. Discard them?"),this._hasUnsavedChanges=!e),!e)return window.history.pushState(null,"",t.oldURL),void t?.preventDefault();const i=window.location.hash,n=new URLSearchParams(i.slice(1));let o;const s=n.get("gist"),r=n.get("project");if(this._shareButton.activeGist?.id!==s&&(this._shareButton.activeGist=void 0),s)try{o=await this._loadGist(s)}catch(t){t instanceof b&&404===t.status&&(t=new g({heading:"Gist not found",message:"The given GitHub gist could not be found.",stack:t.stack})),w(t)}else r&&(o=this._loadBase64(r));if(this._examplesDrawer.querySelector(".exampleItem.active")?.classList.remove("active"),o)this._hideCodeLanguageSwitch(),this._playgroundProject.config={extends:"/samples/base.json",files:Object.fromEntries(o.map((({name:t,content:e,hidden:i})=>[t,{content:e,hidden:i}])))};else{this._showCodeLanguageSwitch();let t="examples/hello-world";const e=n.get("sample");e?.match(/^[a-zA-Z0-9_\-\/]+$/)&&(t=e);const i="ts"===d()?"/samples":"/samples/js";this._playgroundProject.projectSrc=`${i}/${t}/project.json`;const o=this._examplesDrawer.querySelector(`.exampleItem[data-sample="${t}"]`);o&&(o.classList.add("active"),await customElements.whenDefined("litdev-drawer"),requestAnimationFrame((()=>{this._scrollToCenter(o,this._examplesDrawerScroller)})))}}_hideCodeLanguageSwitch(){this._exampleControls.hideCodeLanguageSwitch=!0}_showCodeLanguageSwitch(){this._exampleControls.hideCodeLanguageSwitch=!1}_scrollToCenter(t,e){const i=e.getBoundingClientRect(),n=t.getBoundingClientRect();(n.bottom>i.bottom||n.top<i.top)&&e.scroll({top:n.top-i.top-i.height/2})}};Z.styles=e`:host{display:contents}`,X([i()],Z.prototype,"githubApiUrl",2),Z=X([o("litdev-playground-page")],Z);export{Z as LitDevPlaygroundPage};
